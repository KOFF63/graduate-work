{% extends 'materials/base.html' %}

{% block title %}–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å{% endblock %}

{% block content %}
<div class="row animate-fade-in">
    <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è -->
    <div class="col-lg-4">
        <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è -->
        <div class="card mb-4 hover-lift">
            <div class="card-body text-center">
                <!-- –ê–≤–∞—Ç–∞—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
                <div class="mb-4">
                    {% if user.userprofile.avatar %}
                    <img src="{{ user.userprofile.avatar.url }}"
                         alt="–ê–≤–∞—Ç–∞—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{ user.username }}"
                         class="rounded-circle img-fluid border"
                         style="width: 150px; height: 150px; object-fit: cover;">
                    {% else %}
                    <div class="d-inline-flex align-items-center justify-content-center
                                    rounded-circle bg-primary text-white"
                         style="width: 150px; height: 150px; font-size: 3rem;">
                        {{ user.username|first|upper }}
                    </div>
                    {% endif %}
                </div>

                <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                <h3 class="mb-2">
                    {% if user.userprofile.display_name %}
                    {{ user.userprofile.display_name }}
                    <small class="text-muted d-block fs-6 mt-1">
                        @{{ user.username }}
                    </small>
                    {% else %}
                    {{ user.username }}
                    <small class="text-muted d-block fs-6 mt-1">
                        <i>–î–æ–±–∞–≤—å—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö</i>
                    </small>
                    {% endif %}
                </h3>

                {% if user.email %}
                <p class="text-muted mb-3">
                    <i class="bi bi-envelope"></i> {{ user.email }}
                </p>
                {% endif %}

                <!-- –†–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
                <div class="mb-3">
                    {% if user.userprofile.role == 'student' %}
                    <span class="badge bg-success fs-6">
                            <i class="bi bi-mortarboard"></i> –°—Ç—É–¥–µ–Ω—Ç
                        </span>
                    {% elif user.userprofile.role == 'teacher' %}
                    <span class="badge bg-info fs-6">
                            <i class="bi bi-person-badge"></i> –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å
                        </span>
                    {% else %}
                    <span class="badge bg-secondary fs-6">
                            <i class="bi bi-person"></i> –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
                        </span>
                    {% endif %}
                </div>

                <!-- –§–∞–∫—É–ª—å—Ç–µ—Ç/–∫–∞—Ñ–µ–¥—Ä–∞ -->
                {% if user.userprofile.department %}
                <p class="text-muted">
                    <i class="bi bi-building"></i> {{ user.userprofile.department }}
                </p>
                {% endif %}

                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è "–û —Å–µ–±–µ" -->
                {% if user.userprofile.bio %}
                <div class="mt-4">
                    <h6 class="border-bottom pb-2">–û —Å–µ–±–µ</h6>
                    <p class="text-muted mt-2">{{ user.userprofile.bio|linebreaks }}</p>
                </div>
                {% endif %}

                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <div class="mt-4 pt-3 border-top">
                    <p class="text-muted small mb-1">
                        <i class="bi bi-calendar"></i> –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:
                        {{ user.date_joined|date:"d.m.Y" }}
                    </p>
                    <p class="text-muted small">
                        <i class="bi bi-clock-history"></i> –ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥:
                        {{ user.last_login|date:"d.m.Y H:i"|default:"–ï—â–µ –Ω–µ –≤—Ö–æ–¥–∏–ª" }}
                    </p>
                </div>
            </div>
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ -->
        <div class="card mb-4 hover-lift">
            <div class="card-header bg-light">
                <h5 class="mb-0">
                    <i class="bi bi-bar-chart"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                </h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-6">
                        <div class="display-6 text-primary">{{ materials_count }}</div>
                        <small class="text-muted">–ú–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</small>
                    </div>
                    <div class="col-6">
                        <div class="display-6 text-success">
                            {{ user.date_joined|date:"Y" }}
                        </div>
                        <small class="text-muted">–ì–æ–¥ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã -->
    <div class="col-lg-8">
        <!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è -->
        <div class="card mb-4 hover-lift">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="bi bi-pencil-square"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
                </h5>
            </div>
            <div class="card-body">
                <form method="post" enctype="multipart/form-data" id="profileForm">
                    {% csrf_token %}

                    <!-- –ê–≤–∞—Ç–∞—Ä -->
                    <div class="mb-4">
                        <label for="avatar" class="form-label">
                            <i class="bi bi-image"></i> –ê–≤–∞—Ç–∞—Ä –ø—Ä–æ—Ñ–∏–ª—è
                        </label>
                        <input type="file"
                               class="form-control"
                               id="avatar"
                               name="avatar"
                               accept="image/*">
                        <div class="form-text">
                            –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –∞–≤–∞—Ç–∞—Ä–∞ (JPG, PNG, GIF).
                            –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 2 MB.
                        </div>

                        {% if user.userprofile.avatar %}
                        <div class="mt-3">
                            <p class="mb-1 small text-muted">–¢–µ–∫—É—â–∏–π –∞–≤–∞—Ç–∞—Ä:</p>
                            <img src="{{ user.userprofile.avatar.url }}"
                                 alt="–¢–µ–∫—É—â–∏–π –∞–≤–∞—Ç–∞—Ä"
                                 class="img-thumbnail"
                                 style="max-width: 100px;">
                            <div class="form-check mt-2">
                                <input class="form-check-input"
                                       type="checkbox"
                                       id="removeAvatar"
                                       name="remove_avatar">
                                <label class="form-check-label small" for="removeAvatar">
                                    –£–¥–∞–ª–∏—Ç—å —Ç–µ–∫—É—â–∏–π –∞–≤–∞—Ç–∞—Ä
                                </label>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    <!-- –û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è -->
                    <div class="mb-4">
                        <label for="display_name" class="form-label">
                            <i class="bi bi-person-circle"></i> –û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è
                        </label>
                        <input type="text"
                               class="form-control"
                               id="display_name"
                               name="display_name"
                               value="{{ user.userprofile.display_name }}"
                               placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥—É—Ç –≤–∏–¥–µ—Ç—å –¥—Ä—É–≥–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏">
                        <div class="form-text">
                            –≠—Ç–æ –∏–º—è –±—É–¥—É—Ç –≤–∏–¥–µ—Ç—å –¥—Ä—É–≥–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–∞ —Å–∞–π—Ç–µ.
                            –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä—É—Å—Å–∫–∏–µ –±—É–∫–≤—ã –∏ –ø—Ä–æ–±–µ–ª—ã.
                        </div>
                    </div>

                    <!-- Email -->
                    <div class="mb-4">
                        <label for="email" class="form-label">
                            <i class="bi bi-envelope"></i> Email –∞–¥—Ä–µ—Å
                        </label>
                        <input type="email"
                               class="form-control"
                               id="email"
                               name="email"
                               value="{{ user.email|default:'' }}"
                               placeholder="your@email.com">
                        <div class="form-text">
                            –ù–∞ —ç—Ç–æ—Ç –∞–¥—Ä–µ—Å –±—É–¥—É—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã).
                        </div>
                    </div>

                    <!-- –õ–æ–≥–∏–Ω (—Ç–æ–ª—å–∫–æ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏) -->
                    <div class="mb-4">
                        <div class="card bg-light">
                            <div class="card-body py-2">
                                <small class="text-muted">
                                    <i class="bi bi-info-circle"></i>
                                    <strong>–õ–æ–≥–∏–Ω –¥–ª—è –≤—Ö–æ–¥–∞:</strong>
                                    <code>{{ user.username }}</code>
                                    <span class="ms-2">(–Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å)</span>
                                </small>
                            </div>
                        </div>
                    </div>
                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è "–û —Å–µ–±–µ" -->
                    <div class="mb-4">
                        <label for="bio" class="form-label">
                            <i class="bi bi-card-text"></i> –û —Å–µ–±–µ
                        </label>
                        <textarea class="form-control"
                                  id="bio"
                                  name="bio"
                                  rows="4"
                                  placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–µ–±–µ, —Å–≤–æ–∏—Ö –∏–Ω—Ç–µ—Ä–µ—Å–∞—Ö, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è—Ö...">{{ user.userprofile.bio }}</textarea>
                        <div class="form-text">
                            –ú–∞–∫—Å–∏–º—É–º 1000 —Å–∏–º–≤–æ–ª–æ–≤. –í—ã –º–æ–∂–µ—Ç–µ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ —Å–≤–æ–µ–π
                            —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏, –∏–Ω—Ç–µ—Ä–µ—Å–∞—Ö –∏–ª–∏ –æ–ø—ã—Ç–µ.
                        </div>
                        <div class="mt-1 text-end">
                            <small class="text-muted" id="bioCounter">
                                <span id="bioLength">{{ user.userprofile.bio|length }}</span>/1000 —Å–∏–º–≤–æ–ª–æ–≤
                            </small>
                        </div>
                    </div>

                    <!-- –†–æ–ª—å -->
                    <div class="mb-4">
                        <label for="role" class="form-label">
                            <i class="bi bi-person-badge"></i> –†–æ–ª—å –≤ —Å–∏—Å—Ç–µ–º–µ
                        </label>
                        <select class="form-select" id="role" name="role">
                            <option value="student" {% if user.userprofile.role == 'student' %}selected{% endif %}>
                            üë®‚Äçüéì –°—Ç—É–¥–µ–Ω—Ç
                            </option>
                            <option value="teacher" {% if user.userprofile.role == 'teacher' %}selected{% endif %}>
                            üë®‚Äçüè´ –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å
                            </option>
                            <option value="other" {% if user.userprofile.role == 'other' or not user.userprofile.role %}selected{% endif %}>
                            üë§ –î—Ä—É–≥–æ–µ
                            </option>
                        </select>
                        <div class="form-text">
                            –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à—É —Ä–æ–ª—å –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —Å–∏—Å—Ç–µ–º–µ.
                        </div>
                    </div>
                    <!-- –§–∞–∫—É–ª—å—Ç–µ—Ç/–∫–∞—Ñ–µ–¥—Ä–∞ -->
                    <div class="mb-4">
                        <label for="department" class="form-label">
                            <i class="bi bi-building"></i> –§–∞–∫—É–ª—å—Ç–µ—Ç / –ö–∞—Ñ–µ–¥—Ä–∞
                        </label>
                        <input type="text"
                               class="form-control"
                               id="department"
                               name="department"
                               value="{{ user.userprofile.department }}"
                               placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –§–∞–∫—É–ª—å—Ç–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π">
                        <div class="form-text">
                            –£–∫–∞–∂–∏—Ç–µ –≤–∞—à —Ñ–∞–∫—É–ª—å—Ç–µ—Ç –∏–ª–∏ –∫–∞—Ñ–µ–¥—Ä—É –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –ø–æ–∏—Å–∫–∞.
                        </div>
                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                        <a href="{% url 'profile' %}" class="btn btn-outline-secondary me-2">
                            <i class="bi bi-x-circle"></i> –û—Ç–º–µ–Ω–∞
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- –ú–æ–∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã -->
        <div class="card hover-lift">
            <div class="card-header bg-light d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="bi bi-folder"></i> –ú–æ–∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
                    <span class="badge bg-primary rounded-pill ms-2">{{ materials_count }}</span>
                </h5>
                <a href="{% url 'home' %}" class="btn btn-sm btn-outline-primary">
                    <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª
                </a>
            </div>
            <div class="card-body">
                {% if user_materials %}
                <div class="list-group list-group-flush">
                    {% for material in user_materials %}
                    <div class="list-group-item border-0 px-0 py-3">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <h6 class="mb-1">
                                    <span class="type-icon">{{ material.get_type_icon }}</span>
                                    {{ material.title }}
                                </h6>
                                <p class="text-muted small mb-2">
                                    {{ material.description|truncatewords:20 }}
                                </p>
                                <div class="d-flex gap-3 small">
                                        <span class="text-muted">
                                            <i class="bi bi-book"></i> {{ material.subject.name }}
                                        </span>
                                    <span class="text-muted">
                                            <i class="bi bi-calendar"></i> {{ material.upload_date|date:"d.m.Y" }}
                                        </span>
                                    <span class="badge bg-primary">{{ material.get_material_type_display }}</span>
                                </div>
                            </div>
                            <div class="ms-3">
                                <a href="#" class="btn btn-sm btn-outline-primary">
                                    <i class="bi bi-eye"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                    {% if not forloop.last %}
                    <hr class="my-1 mx-3">
                    {% endif %}
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-5">
                    <div class="mb-3">
                        <i class="bi bi-folder-x" style="font-size: 3rem; color: #6c757d;"></i>
                    </div>
                    <h5 class="text-muted">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</h5>
                    <p class="text-muted mb-4">
                        –ù–∞—á–Ω–∏—Ç–µ –¥–æ–±–∞–≤–ª—è—Ç—å —É—á–µ–±–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã, —á—Ç–æ–±—ã –æ–Ω–∏ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –∑–¥–µ—Å—å.
                    </p>
                    <a href="{% url 'home' %}" class="btn btn-primary">
                        <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // –ü–æ–¥—Å—á–µ—Ç —Å–∏–º–≤–æ–ª–æ–≤ –≤ –ø–æ–ª–µ "–û —Å–µ–±–µ"
    document.addEventListener('DOMContentLoaded', function() {
        const bioTextarea = document.getElementById('bio');
        const bioCounter = document.getElementById('bioCounter');
        const bioLength = document.getElementById('bioLength');

        if (bioTextarea) {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –ø—Ä–∏ –≤–≤–æ–¥–µ
            bioTextarea.addEventListener('input', function() {
                const length = this.value.length;
                bioLength.textContent = length;

                // –ú–µ–Ω—è–µ–º —Ü–≤–µ—Ç –µ—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç
                if (length > 1000) {
                    bioCounter.classList.remove('text-muted');
                    bioCounter.classList.add('text-danger');
                } else {
                    bioCounter.classList.remove('text-danger');
                    bioCounter.classList.add('text-muted');
                }
            });

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—á–µ—Ç—á–∏–∫
            bioTextarea.dispatchEvent(new Event('input'));
        }

        // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —É–π—Ç–∏ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        const form = document.getElementById('profileForm');
        let formChanged = false;

        if (form) {
            const formInputs = form.querySelectorAll('input, textarea, select');

            formInputs.forEach(input => {
                input.addEventListener('change', function() {
                    formChanged = true;
                });

                // –î–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–ª–µ–π –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –≤–≤–æ–¥
                if (input.type === 'text' || input.tagName === 'TEXTAREA') {
                    const initialValue = input.value;
                    input.addEventListener('input', function() {
                        if (this.value !== initialValue) {
                            formChanged = true;
                        }
                    });
                }
            });

            // –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º—ã —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥
            form.addEventListener('submit', function() {
                formChanged = false;
            });

            // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —É–π—Ç–∏
            window.addEventListener('beforeunload', function(e) {
                if (formChanged) {
                    e.preventDefault();
                    e.returnValue = '–£ –≤–∞—Å –µ—Å—Ç—å –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è. –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–π—Ç–∏?';
                }
            });
        }

        // –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∞–≤–∞—Ç–∞—Ä–∞ –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π
        const avatarInput = document.getElementById('avatar');
        if (avatarInput) {
            avatarInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–º–∞–∫—Å 2MB)
                    if (file.size > 2 * 1024 * 1024) {
                        alert('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 2 MB.');
                        this.value = '';
                        return;
                    }

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø —Ñ–∞–π–ª–∞
                    if (!file.type.startsWith('image/')) {
                        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (JPG, PNG, GIF).');
                        this.value = '';
                        return;
                    }

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –Ω–∞—Ö–æ–¥–∏–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø—Ä–µ–≤—å—é
                        let previewContainer = document.getElementById('avatarPreview');
                        if (!previewContainer) {
                            previewContainer = document.createElement('div');
                            previewContainer.id = 'avatarPreview';
                            previewContainer.className = 'mt-3';
                            avatarInput.parentNode.appendChild(previewContainer);
                        }

                        previewContainer.innerHTML = `
                            <p class="mb-1 small text-muted">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä:</p>
                            <img src="${event.target.result}"
                                 alt="–ü—Ä–µ–≤—å—é –∞–≤–∞—Ç–∞—Ä–∞"
                                 class="img-thumbnail"
                                 style="max-width: 100px; max-height: 100px;">
                        `;
                    };
                    reader.readAsDataURL(file);
                }
            });
        }
    });
</script>
{% endblock %}